# 自动化测试用例编写指南 (简化版)

本指南旨在帮助测试人员快速上手自动化测试用例编写，无需深入了解底层代码，只需关注业务逻辑。

## 1. 快速开始：三步走

### 第一步：准备测试数据
打开 `data/api_test_data.yml`，在文件末尾添加你的测试数据。
格式如下：
```yaml
# 用例函数名
test_demo_login:
  # 参数说明注释
  # username, password, expect_success, expect_code, expect_msg
  - ["user1", "123456", True, 0, "登录成功"]
  - ["user2", "wrong", False, 1001, "密码错误"]
```

### 第二步：编写测试脚本
在 `testcases/api_test/` 目录下创建一个新的 Python 文件（例如 `test_new_feature.py`）。
使用我们封装好的 DSL 接口：

```python
import allure
import pytest
from core.simple_test import Step
from testcases.conftest import api_data

@allure.feature("新功能测试")
class TestNewFeature:

    @allure.title("测试场景标题")
    @pytest.mark.parametrize("username, password, expect_success, expect_code, expect_msg", 
                             api_data.get("test_demo_login", []))
    def test_demo_login(self, user_business, username, password, expect_success, expect_code, expect_msg):
        
        # 使用 Step 接口，一句代码完成 调用 + 断言
        Step("登录步骤")\
            .call(user_business.login_user, username, password)\
            .validate(success=expect_success, code=expect_code, msg=expect_msg)
```

### 第三步：运行测试
双击根目录下的 `run_tests.bat` 即可执行测试并生成报告。

## 2. 进阶用法：Step 接口详解

`Step` 类是我们为简化测试编写而设计的核心工具，它支持链式调用。

### 2.1 基础语法
```python
Step("步骤名称").call(业务函数, 参数1, 参数2...).validate(验证参数...)
```

### 2.2 参数说明
*   `call(func, *args, **kwargs)`:
    *   `func`: 业务层封装的函数（如 `user_business.login_user`）。
    *   `*args`: 传递给业务函数的参数。
*   `validate(success=True, code=None, msg=None)`:
    *   `success`: 预期业务是否成功 (True/False)。
    *   `code`: 预期返回的错误码 (如 0, 404, 500)。
    *   `msg`: 预期返回消息中包含的字符串 (支持模糊匹配)。

### 2.3 分步写法（调试用）
如果需要对结果做更多自定义断言，可以分步执行：
```python
# 1. 执行并获取结果
step = Step("查询用户").call(user_business.get_user, "admin")
result = step.get_result()

# 2. 自定义断言
assert result.data["age"] > 18
```

## 3. 常见问题
*   **Q: 找不到 YAML 数据？**
    *   A: 请确保 YAML 中的 `key`（如 `test_demo_login`）与测试函数名完全一致。
*   **Q: 报告中没有步骤详情？**
    *   A: `Step` 类自动集成了 Allure，只要使用 `Step`，报告中就会自动展示步骤和断言结果。
