# 项目说明
```text
项目基于Python+pytest+request+allure编写的自动化测试框架的demo。

参考测试接口源码：https://github.com/jinjiacheng2018/flaskDemo
参考框架搭建源码：https://github.com/jinjiacheng2018/pytestDemo

参考博客文章：https://www.cnblogs.com/wintest/p/13423231.html
```

# 项目结构说明
```yaml
python-autotest-trae/
├── common/           # 公共模块
├── config/           # 配置文件
│   ├── __init__.py
│   └── settings.py
├── core/             # requests请求方法封装、关键字返回结果类
├── data/             # 数据文件
├── logs/             # 日志文件
├── operation/        # 自定义关键字
├── report/           # 测试报告
├── testcases/         # 测试用例
├── utils/            # 工具函数
│   ├── __init__.py
│   └── logger.py
├── app.py           # 主程序入口
├── py.demotest.ini       # pytest配置
├── requirements.txt  # 依赖列表
├── README.md         # 项目说明
└── .gitignore        # Git忽略配置
```

# 框架搭建步骤
```text
1. 创建项目的各个包、文件夹
2. 搭建基础的框架
    - a) config: 添加mysql.ini、setting.ini配置文件
    - b) common: 添加基础的工具类
        - logger.py: 首先添加日志框架，构建基础的日志打印
        - read_data.py: 添加数据读取模块，读取配置文件
        - mysql_operate.py: 添加MySQL数据库操作模块，查询、插入、更新、删除
    - c) core: 
        - 添加rest_client.py模块，用于reques基础的请求方法封装、关键字返回结果类
        - 添加result.py模块，封装关键字返回结果类
    - d) api: 添加User.py模块并集成封装的接口类，进一步封装接口API
    - e) operation: 添加User关键字封装模块，封装关键字
    - f) data: 准备测试数据
        - base_data.yaml: 添加基础的准备数据
    - g) testcase: 添加测试用例
        - config.py: 添加测试用例配置文件(基础配置文件)
        - api_test
            - config.py: 添加测试用例配置文件(基础配置文件)
            - test_01_get_user_info.py: 添加测试用例
 3. todo
```

# 关键字封装说明
```text
关键字应该是具有一定业务意义的，在封装关键字的时候，可以通过调用多个Python接口来完成。
在某些情况下，比如测试一个充值接口的时候，在充值后可能需要调用查询接口得到最新账户余额，来判断查询结果与预期结果是否一致，那么可以这样来进行测试：

1, 首先，可以把 充值-查询 的操作封装为一个关键字，在这个关键字中依次调用充值和查询的接口，并可以自定义关键字的返回结果。
2, 接着，在编写测试用例的时候，直接调用关键字来进行测试，这时就可以拿到关键字返回的结果，那么断言的时候，就可以直接对关键字返回结果进行断言。

```

# 测试系统说明
```text
system: xxx数字协同平台
url: http://39.174.76.164:29020/
username: 19000000004
password: 123456
code: 123456
```

# 关于查看python依赖包版本地址
```text
最常用 & 最推荐（工程师首选）
1️⃣ PyPI 官方网站（权威源头）
👉 https://pypi.org
以 urllib3 为例,打开：https://pypi.org/project/urllib3/

看右侧 Release history点进去能看到：
所有版本号
发布时间
是否 yanked（撤回）
📌 这是最权威的版本来源
```

# 关于封装request的好处
```text
公众号内容：https://mp.weixin.qq.com/s/jU_3Ag8p2LAlMkBjFzX_fw

| 目标           | 对应封装能力                          |
| --------      | ------------------------------- |
| 减少重复代码     | 统一 request 入口                   |
| 提升健壮性      | 统一异常处理 + 重试                     |
| 降低环境切换成本  | base_url / headers / token 集中管理 |
| 适配测试生态    | 日志、断言、allure、pytest             |
| 降低使用门槛     | 屏蔽 requests 细节，提供业务级接口          |

```

# Pytest 用例收集流程图（逻辑顺序）
```text
┌─────────────────────────────┐
│      pytest 启动命令         │
│  pytest 或 pytest <path>    │
└─────────────┬───────────────┘
              │
              ▼
┌─────────────────────────────┐
│   配置文件检查 pytest.ini    │
│   testpaths 是否配置？       │
└─────────────┬───────────────┘
     Yes      │       No
              ▼
┌─────────────────────────────┐
│  从 testpaths 指定目录收集文件 │
└─────────────┬───────────────┘
              ▼
┌─────────────────────────────┐
│  文件名是否符合 python_files? │
│  (默认 test_*.py / *_test.py) │
└─────────────┬───────────────┘
     Yes      │       No
              ▼
┌─────────────────────────────┐
│  类名是否符合 python_classes? │
│   (默认 Test*)                │
└─────────────┬───────────────┘
     Yes      │       No
              ▼
┌─────────────────────────────┐
│ 函数名是否符合 python_functions? │
│     (默认 test_*)               │
└─────────────┬───────────────┘
     Yes      │       No
              ▼
┌─────────────────────────────┐
│        收集到用例            │
└─────────────────────────────┘

✨ 特殊情况：
- 命令行显式指定路径或文件，会覆盖 testpaths
- pytest.ini 只提供默认规则，命令行优先
- marker / addopts 等配置不会影响收集，只影响执行
```

# 参考地址
https://mp.weixin.qq.com/s/tp-CXm6adA0z9CrubpiEhA


# Allure查看报告说明

# 一、Allure 必须分清的两样东西（99% 新手卡这）

| 名称                | 作用               | 安装方式                        |
| ----------------- | ---------------- | --------------------------- |
| **allure-pytest** | pytest → 生成 json | `pip install allure-pytest` |
| **Allure CLI**    | json → HTML 报告   | **单独安装**（不是 pip）            |

👉 你现在 **已经有前者，缺后者**

---

# 二、Windows 安装 Allure CLI（最稳妥做法）✅

## ✅ 方法一：官方 ZIP 安装（最推荐，企业常用）

### 1️⃣ 下载 Allure

打开浏览器，下载 **Allure Commandline（zip）**，例如：https://github.com/allure-framework/allure2/releases/tag/2.30.0

👉 搜索关键词：

> **Allure Commandline GitHub Release**

下载类似：

```text
allure-2.27.0.zip   （版本号可能不同）
```

---

### 2️⃣ 解压到固定目录（重要）

例如：

```text
D:\tools\allure-2.27.0\
```

目录结构应是：

```text
D:\tools\allure-2.27.0\
├─ bin\
│  ├─ allure.bat   ✅
│  └─ allure
├─ lib\
└─ plugins\
```

---

### 3️⃣ 配置环境变量（关键一步）

#### 添加到 **Path**

```text
D:\tools\allure-2.27.0\bin
```

步骤（简述）：

* 系统设置 → 环境变量
* Path → 新增
* 粘贴上面路径
* 确定 → **重开 CMD / PowerShell**

---

### 4️⃣ 验证是否成功

重新打开命令行：

```bash
allure --version
```

如果看到版本号：

```text
2.27.0
```

🎉 **安装成功**

---

# 三、重点：真正“看报告” 🎉
```bash
# 进入到报告的目录下
cd /d/MyWorkspaces/python-autotest-trae/report

# 生成报告
allure generate allure-results -o allure-html --clean

# 查看报告(浏览器会自动打开 Allure 报告)
allure open allure-html
```

---

# 四、如果你想“最快验证”（不想生成目录）

```bash
allure serve report/allure-results
```

👉 临时服务，验证用，很快看到页面。

---

# 五、常见问题排雷（你可能马上会遇到）

### ❓ 双击 `index.html` 打不开？

✔ 正常，Allure 需要本地服务

---

### ❓ 中文会不会乱码？

✔ 一般不会
✔ Allure 内部用 UTF-8
⚠️ 需要 JDK（通常你机器已经有）

---

### ❓ 需要 Java 吗？

✔ **需要 JDK 8+**
可验证：

```bash
java -version
```

---

# 六、一步到位（给你企业级做法）

以后你可以只记住一句：

```text
pytest  →  allure-results  →  allure-report
```

并把下面流程固化：

```bash
python run.py
allure generate report/allure-results -o report/allure-report --clean
allure open report/allure-report
```

---

# 七、你现在所处的阶段（说句实在的）

你已经完整走通了：

✅ pytest
✅ 参数化
✅ 日志
✅ Allure JSON
⬜ **Allure CLI（最后一步）**

**这已经是“中高级测试工程师”的完整链路了。**

---


```bash
python run.py
# 自动生成 + 打开报告
```
